function [U]=umatrix_generator_general(v1, v2)
    r1 = v1(:, 1:3);
    xs1 = v1(:, 4:6);
    r2 = v2(:, 1:3);
    xs2 = v2(:, 4:6);
    M1 = cross(xs1, r1, 2); % n*3
    M2 = cross(xs2, r2, 2); % n*3
% 	  U =[r1(:,1).*r2(:,1) r1(:,1).*r2(:,2) r1(:,1).*r2(:,3) ...
%        r1(:,2).*r2(:,1) r1(:,2).*r2(:,2) r1(:,2).*r2(:,3) ...
%        r1(:,3).*r2(:,1) r1(:,3).*r2(:,2) r1(:,3).*r2(:,3) ...
%            r1(:,1).*M2(:,1)+M1(:,1).*r2(:,1) ...
%            r1(:,1).*M2(:,2)+M1(:,1).*r2(:,2) ...
%            r1(:,1).*M2(:,3)+M1(:,1).*r2(:,3) ...
%            r1(:,2).*M2(:,1)+M1(:,2).*r2(:,1) ...
%            r1(:,2).*M2(:,2)+M1(:,2).*r2(:,2) ...
%            r1(:,2).*M2(:,3)+M1(:,2).*r2(:,3) ...
%            r1(:,3).*M2(:,1)+M1(:,3).*r2(:,1) ...
%            r1(:,3).*M2(:,2)+M1(:,3).*r2(:,2) ...
%            r1(:,3).*M2(:,3)+M1(:,3).*r2(:,3)];  % u n*18
       
   U =[-r1(:,1).*r2(:,1) -r1(:,1).*r2(:,2) -r1(:,1).*r2(:,3) ...
       -r1(:,2).*r2(:,1) -r1(:,2).*r2(:,2) -r1(:,2).*r2(:,3) ...
       -r1(:,3).*r2(:,1) -r1(:,3).*r2(:,2) -r1(:,3).*r2(:,3) ...
           r1(:,1).*M2(:,1)+M1(:,1).*r2(:,1) ...
           r1(:,2).*M2(:,1)+M1(:,2).*r2(:,1) ...
           r1(:,3).*M2(:,1)+M1(:,3).*r2(:,1) ...
           r1(:,1).*M2(:,2)+M1(:,1).*r2(:,2) ...
           r1(:,2).*M2(:,2)+M1(:,2).*r2(:,2) ...
           r1(:,3).*M2(:,2)+M1(:,3).*r2(:,2) ...
           r1(:,1).*M2(:,3)+M1(:,1).*r2(:,3) ...
           r1(:,2).*M2(:,3)+M1(:,2).*r2(:,3) ...
           r1(:,3).*M2(:,3)+M1(:,3).*r2(:,3)];
end